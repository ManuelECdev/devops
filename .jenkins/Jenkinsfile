pipeline {
    agent any

    stages {
        stage('Build') {
            steps {
		sh """
                    export PATH="/home/linuxbrew/.linuxbrew/bin:/home/linuxbrew/.linuxbrew/sbin:/var/lib/jenkins/.local/bin:$PATH"
                    echo ${PATH}
		    make install
		    make lint
                    make hadolint
                    echo "building with docker"
                    docker build --tag=udafinalproject-${env.BUILD_TAG} .
                    echo "docker image ls"
                    docker image ls
                    echo "Docker ID and Image: manuelecdev/udafinalproject-${env.BUILD_TAG}"
                    cat /password | docker login --username manuelecdev --password-stdin && docker image tag udafinalproject-${env.BUILD_TAG} "manuelecdev/udafinalproject-${env.BUILD_TAG}
                    echo "docker image push"
                    docker image push "manuelecdev/udafinalproject-${env.BUILD_TAG}
                """
                echo "env ${env.BUILD_ID} on ${env.JENKINS_URL}"
		echo "env ${env.BUILD_NUMBER} on ${env.JOB_NAME}"
		echo "env ${env.EXECUTOR_NUMBER} on ${env.BUILD_TAG}"
		echo "env ${env.WORKSPACE} on ${env.NODE_NAME}"
            }
        }
    }
}
